<!DOCTYPE html>

<html>
    <head>        
        <!-- CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

<!-- jQuery and JS bundle w/ Popper.js -->
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://sdk.amazonaws.com/js/aws-sdk-2.774.0.min.js"></script>
        <script src="./js/s3config.json"></script>
        <script src="./js/users.js"></script>

        <script type="text/javascript">
        console.log("--- uploading "+ data.id);
            //Bucket Configurations
            var bucketName = "test-bucket-sjsu";
            var bucketRegion = "us-west-2";            
            
             AWS.config.update({
                            region: bucketRegion,                            
                            accessKeyId: data.id,
                            secretAccessKey: data.secret
                        });
            
                        var s3 = new AWS.S3({
                            apiVersion: '2006-03-01',
                            params: {Bucket: bucketName}
                        });

                        function abc(){
                            console.log("abc");
                                            var files = document.getElementById('fileupload').files;
                    if (files) 
                    {
                    var file = files[0];
                    var fileName = file.name;
                    var filePath = fileName;
                    var fileUrl = 'https://' +bucketName+"."+ "s3-"+bucketRegion + '.amazonaws.com/'+fileName;
                    s3.upload({
                    Key: filePath,
                    Body: file,
                    ACL: 'public-read'
                    }, function(err, data) {
                    if(err) {
                        console.log(`error in uploading ${err}`);
                    // reject('error');
                    }
                    else{
                        console.log(JSON.stringify(data));
                    }
                    alert('Successfully Uploaded!');
                    });                    
      }
                        }

    //                     $("#upload").click(() => {
    //                         console.log("---1---");
    //                 var files = document.getElementById('fileUpload').files;
    //                 if (files) 
    //                 {
    //                 var file = files[0];
    //                 var fileName = file.name;
    //                 var filePath = 'test-bucket-sjsu/' + fileName;
    //                 var fileUrl = 'https://' +bucketName+"."+ bucketRegion + '.amazonaws.com/'+fileName;
    //                 s3.upload({
    //                 Key: filePath,
    //                 Body: file,
    //                 ACL: 'public-read'
    //                 }, function(err, data) {
    //                 if(err) {
    //                     console.log(`error in uploading ${err}`);
    //                 reject('error');
    //                 }
    //                 alert('Successfully Uploaded!');
    //                 });
                    
    //   }
    //                     });
                    

            </script>

            
    </head>
    <body">
        <nav class="navbar navbar-light bg-light justify-content-between">
            <p id="welcome" class="navbar-brand"></p>
            <form action="logout">                
            <button type="submit" class="btn btn-outline-success my-2 my-sm-0" id="logout">Logout</button>
            </form>
        </nav>
        <hr>
        <nav class="navbar navbar-light bg-light justify-content-between">
            <label for="fileuplaod" class="navbar-brand">Choose a file to upload</label>
            <input type="file" id="fileupload">
            <button onclick="abc()" id="upload">Upload</button>
        </nav>

        
    </body>
</html>
